# 降水データ分析結果の比較解説（全データ vs 有降水のみ）

## 処理概要

- **対象期間**: 2018 年 1 月〜2023 年 12 月（72 ヶ月分）
- **処理時間**: 約 27 分（1616 秒、前回より増加は両方の集計を行ったため）
- **総データ点数**: 約 40 億点（4,038,451,200 点）
- **有降水データ点数**: 約 6 億点（598,928,672 点）= **全体の約 14.8%**

→ **重要**: データの約 85%は無降水（ft4, ft5, ft6, sum すべて 0）であることが判明

---

## 1. 3 つの降水ターゲット（ft4, ft5, ft6）の一致度比較

### 標準偏差（sd_triplet）

| 指標     | 全データ | 有降水のみ   | 倍率       |
| -------- | -------- | ------------ | ---------- |
| 平均     | 0.093 mm | **0.506 mm** | **5.4 倍** |
| 標準偏差 | 0.503 mm | 1.129 mm     | 2.2 倍     |
| 最大     | 99.5 mm  | 99.5 mm      | 同じ       |

**解釈**:

- 無降水データが大量に含まれていたため、全データの平均が 0.093 mm と極端に小さかった
- **実際に雨が降っている時の 3 ターゲット間のばらつきは平均 0.506 mm**と、全データの約 5.4 倍
- 有降水時でも標準偏差は 1.129 mm なので、依然として比較的小さいが、全データで見るよりは有意な差がある

### レンジ（max - min）

| 指標     | 全データ | 有降水のみ   | 倍率       |
| -------- | -------- | ------------ | ---------- |
| 平均     | 0.215 mm | **1.174 mm** | **5.5 倍** |
| 標準偏差 | 1.156 mm | 2.606 mm     | 2.3 倍     |
| 最大     | 223.2 mm | 223.2 mm     | 同じ       |

**解釈**:

- 有降水時の 3 ターゲット間の最大差は平均 1.174 mm で、全データの 5.5 倍
- これは無降水の影響を除くと、実際にはターゲット間でより大きな差が存在することを示している

### 閾値別一致度の劇的な変化

| 閾値     | 全データ  | 有降水のみ | 変化        |
| -------- | --------- | ---------- | ----------- |
| ≤ 0.0 mm | **73.3%** | **3.0%**   | **▼70.3pt** |
| ≤ 0.1 mm | 84.5%     | 27.7%      | ▼56.8pt     |
| ≤ 0.5 mm | 91.7%     | 55.8%      | ▼35.9pt     |
| ≤ 1.0 mm | 94.8%     | 70.8%      | ▼24.0pt     |
| ≤ 2.0 mm | 97.3%     | 84.2%      | ▼13.1pt     |

**重要な発見**:

- 全データでは 73.3%が「完全一致」だったが、これは**ほとんどが無降水（0=0=0）**だったため
- **有降水時に 3 者が完全一致するのはわずか 3.0%**しかない
- 有降水時でも、**約 28%は 0.1 mm 以内**、**約 56%は 0.5 mm 以内**に収まる
- しかし全データの印象とは大きく異なり、**有降水時には約 30%が 1 mm 以上の差**を持つ

→ **結論の修正**: 前回「冗長性が非常に高い」としたが、これは無降水の影響。**実際に雨が降っている時は、3 つのターゲットは思ったより独立した情報を持っている可能性が高い**

---

## 2. 3 時間積算/3 との整合性比較

### ft4 - sum/3

| 指標         | 全データ   | 有降水のみ    | 倍率       |
| ------------ | ---------- | ------------- | ---------- |
| MAE          | 0.095 mm   | **0.509 mm**  | **5.4 倍** |
| RMSE         | 0.559 mm   | 1.330 mm      | 2.4 倍     |
| 平均符号付き | +0.0007 mm | **-0.019 mm** | -          |

### ft5 - sum/3

| 指標         | 全データ   | 有降水のみ    | 倍率       |
| ------------ | ---------- | ------------- | ---------- |
| MAE          | 0.064 mm   | **0.354 mm**  | **5.5 倍** |
| RMSE         | 0.407 mm   | 1.001 mm      | 2.5 倍     |
| 平均符号付き | -0.0001 mm | **+0.037 mm** | -          |

### ft6 - sum/3

| 指標         | 全データ   | 有降水のみ    | 倍率       |
| ------------ | ---------- | ------------- | ---------- |
| MAE          | 0.095 mm   | **0.513 mm**  | **5.4 倍** |
| RMSE         | 0.555 mm   | 1.351 mm      | 2.4 倍     |
| 平均符号付き | -0.0006 mm | **-0.018 mm** | -          |

**解釈**:

- **ft5 が依然として最も誤差が小さい**（有降水時 MAE=0.354 mm）
- しかし有降水時の誤差は全データの約 5.4〜5.5 倍に増加
- **有降水時には系統的なバイアスが存在**:
  - ft4: -0.019 mm（やや過小評価）
  - ft5: +0.037 mm（やや過大評価）
  - ft6: -0.018 mm（やや過小評価）

→ **示唆**: 「3 時間積算/3」で代用する場合、有降水時には平均 0.3〜0.5 mm の誤差が生じる。これが許容できるかは用途次第。

---

## 3. 相関係数の比較

| ペア       | 全データ | 有降水のみ | 変化   |
| ---------- | -------- | ---------- | ------ |
| ft4 vs ft5 | 0.686    | 0.670      | ▼0.016 |
| ft4 vs ft6 | 0.477    | 0.444      | ▼0.033 |
| ft5 vs ft6 | 0.690    | 0.662      | ▼0.028 |

**解釈**:

- 相関係数は有降水のみでやや低下（0.444〜0.670）
- **ft5 と ft6 の相関が最も高い**点は変わらないが、有降水時は 0.662 と全データ時より低い
- **ft4 と ft6 の相関が最も低い**（0.444）ことから、ft4 と ft6 は比較的独立した情報を持つ

→ **結論**: 有降水時には相関がやや弱まり、3 つのターゲットがより独立した振る舞いを示す

---

## 総合結論（修正版）

### 1. 無降水データの影響が甚大だった

全データの約 85%が無降水で、これが平均値を大きく引き下げていた

### 2. 有降水時の冗長性は思ったより低い

- 3 つのターゲットが完全一致するのはわずか 3.0%
- 約 28%が 0.1 mm 以内だが、約 44%は 0.5 mm 超の差がある
- 約 30%は 1 mm 以上の差を持つ

### 3. ft5 は依然として最も代表的

有降水時でも sum/3 との誤差が最小（MAE=0.354 mm）

### 4. 個別予測の価値は当初の想定より高い

- 有降水時には 3 つのターゲット間で平均 0.5〜1.2 mm の差があり、これは降水予測では無視できない
- 単純に「積算/3」で代用すると、有降水時に平均 0.3〜0.5 mm の誤差が生じる
- 極端な降水事例では 100 mm 以上の誤差も発生しうる

### 5. 推奨される方針

#### オプション 1: 軽量化が最優先

- **3 時間積算のみ予測し、必要に応じて 1/3 分割**
- メリット: モデル出力が 1/3 に削減、計算コスト低減
- デメリット: 有降水時に平均 0.3〜0.5 mm の誤差

#### オプション 2: 精度が重要

- **3 つのターゲットを個別に予測する**
- メリット: 有降水事例での精度向上
- デメリット: 現状維持（モデルの複雑さそのまま）

#### オプション 3: 中間案

- **ft5 のみ予測し、ft4/ft6 は統計的補正で推定**
- メリット: モデル出力が 2/3 に削減、ft5 が最も代表的
- デメリット: ft4 と ft6 の推定に追加処理が必要

---

## データの品質

正規化・逆変換の整合性は依然として完璧（数値誤差レベルで一致）

---

## 参考: 詳細データ

### 全データの統計

- 総データ点数: 4,038,451,200
- sd_triplet 平均: 0.093 mm
- max-min 平均: 0.215 mm
- ft4 MAE: 0.095 mm
- ft5 MAE: 0.064 mm
- ft6 MAE: 0.095 mm

### 有降水のみの統計

- 有降水データ点数: 598,928,672 (全体の 14.8%)
- sd_triplet 平均: 0.506 mm
- max-min 平均: 1.174 mm
- ft4 MAE: 0.509 mm
- ft5 MAE: 0.354 mm
- ft6 MAE: 0.513 mm

---

**生成日時**: 2025 年 10 月 10 日
**データ期間**: 2018 年 1 月〜2023 年 12 月（72 ヶ月）
**分析スクリプト**: check_prmsl.py
